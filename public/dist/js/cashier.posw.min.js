/*!
 * Point Of Sales Warung
 * Licensed under GPL (https://github.com/rezafikkri/Point-Of-Sales-Warung/blob/master/LICENSE)
 */
!function(){"use strict";function t(t,e){e.classList.replace("modal__content--animate-show","modal__content--animate-hide"),setTimeout((()=>{e.classList.remove("modal__content--animate-hide"),t.classList.replace("modal--fade-in","modal--fade-out")}),100),setTimeout((()=>{t.classList.remove("modal--fade-out"),t.classList.remove("modal--show"),t.classList.remove("d-block")}),200)}function e(t,e){const a=document.createElement("div");a.classList.add("alert");for(const e of t)a.classList.add(e);return a.innerHTML=`<span class="alert__icon"></span>\n    <p>${e}</p>\n    <a class="alert__close" href="#"></a>`,a}function a(t){return t.toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0})}const r=document.querySelector("main.main"),n=document.querySelector("a#show-cart"),d=document.querySelector("a#search-product"),o=document.querySelector("a#cancel-transaction"),s=document.querySelector("a#finish-transaction"),l=document.querySelector("aside.cart table.table");function c(t,e,r){t.querySelector("td#qty-total").innerText=e,t.querySelector("td#qty-total").dataset.qtyTotal=e,t.querySelector("td#payment-total").innerText=a(r),t.querySelector("td#payment-total").dataset.paymentTotal=r}function i(t,e){let r="",n=0,d=0;e.forEach((t=>{const e=parseInt(t.harga_produk)*parseInt(t.jumlah_produk);r+=`<tr data-product-id="${t.produk_id}" data-transaction-detail-id="${t.transaksi_detail_id}">\n            <td width="10"><a href="#" title="Hapus produk" id="remove-product"  class="text-hover-red">\n                <svg xmlns="http://www.w3.org/2000/svg" width="19" fill="currentColor" viewBox="0 0 16 16"><path d="M2.037 3.225l1.684 10.104A2 2 0 0 0 5.694 15h4.612a2 2 0 0 0 1.973-1.671l1.684-10.104C13.627 4.224 11.085 5 8 5c-3.086 0-5.627-.776-5.963-1.775z"/><path fill-rule="evenodd" d="M12.9 3c-.18-.14-.497-.307-.974-.466C10.967 2.214 9.58 2 8 2s-2.968.215-3.926.534c-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466zM8 5c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2z"/></svg>\n            </a></td>\n            <td width="10"><a href="#" title="Tambah jumlah produk" id="add-product-qty">\n                <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 11.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z"/></svg>\n            </a></td>\n            <td width="10"><a href="#" title="Kurangi jumlah produk" id="reduce-product-qty">\n                <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"/></svg>\n            </a></td>\n            <td>${t.nama_produk}</td>\n            <td id="price" data-price="${t.harga_produk}">\n                ${a(parseInt(t.harga_produk))} / ${t.besaran_produk}\n            </td>\n            <td id="qty" data-qty="${t.jumlah_produk}">${t.jumlah_produk}</td>\n            <td id="payment" data-payment="${e}">${a(e)}</td>\n        </tr>`,n+=e,d+=parseInt(t.jumlah_produk)})),t.querySelector("tbody").innerHTML=r,c(t,d,n)}const u=document.querySelector("aside.cart");n.addEventListener("click",(t=>{t.preventDefault(),u.classList.add("cart--animate-show"),setTimeout((()=>{u.classList.remove("cart--animate-show"),u.classList.add("cart--show"),window.screen.width<=991.98&&document.querySelector("body").classList.add("overflow-hidden")}),500);const e=r.dataset.csrfName,a=r.dataset.csrfValue;void 0===l.dataset.typeShow&&(document.querySelector("div#cart-loading").classList.remove("d-none"),n.classList.add("btn--disabled"),fetch("/kasir/tampil_transaksi_detail",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`${e}=${a}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none"),n.classList.remove("btn--disabled")})).then((t=>t.json())).then((t=>{if(void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),null!==t.transaction_details){if(t.transaction_details.length>0&&i(l,t.transaction_details),"rollback-transaction"===t.type){const e=parseInt(t.customer_money);document.querySelector('input[name="customer_money"]').value=e;m(e,parseInt(l.querySelector("td#payment-total").dataset.paymentTotal))}l.dataset.typeShow=t.type}})).catch((t=>{console.error(t)})))}));const p=u.querySelector("a#btn-close");function m(t,e){const r=document.querySelector('input[name="change_money"]');t>=e?r.value=a(t-e):""!==r.value&&(r.value="")}p.addEventListener("click",(t=>{t.preventDefault(),u.classList.replace("cart--show","cart--animate-hide"),setTimeout((()=>{u.classList.remove("cart--animate-hide")}),450),document.querySelector("body").classList.remove("overflow-hidden")})),r.addEventListener("change",(t=>{let e=t.target;if("magnitude"===e.getAttribute("name")){const t=e.selectedOptions[0].dataset.productPrice;e.previousElementSibling.previousElementSibling.innerText=a(parseInt(t))}})),d.addEventListener("click",(t=>{t.preventDefault();const e=r.querySelector("div.container-xl"),a=document.querySelector('input[name="product_name_search"]').value,n=r.dataset.csrfName,o=r.dataset.csrfValue;if(""===a.trim())return!1;e.innerHTML='<div id="search-loading" class="d-flex justify-content-center align-items-center mt-4">\n    <div class="loading"><div></div></div>\n</div>',d.classList.add("btn--disabled"),fetch("/kasir/cari_produk",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`product_name=${a}&${n}=${o}`}).finally((()=>{e.querySelector("div#search-loading").remove(),d.classList.remove("btn--disabled")})).then((t=>t.json())).then((t=>{if(void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),t.products_db.length>0){const a=r.dataset.baseUrl;let n=`<span class="text-muted me-1 d-block mb-3" id="result-status">\n                    1 - ${t.products_db.length} dari ${t.product_search_total} Total produk hasil pencarian</span>`;n+='<h5 class="mb-2 main__title">Produk</h5><div class="product mb-4">',t.products_db.forEach((t=>{n+=`<div class="product__item" data-product-id="${t.product_id}">\n                    <div class="product__image">\n                        <img src="${a}/dist/images/product_photo/${t.product_photo}" alt="${t.product_name}">\n                    </div>\n                    <div class="product__info">\n                        <p class="product__name">${t.product_name}</p>\n                        <p class="product__category">${t.category_name}</p>\n                        <p class="product__sale" data-product-sale="${t.product_sale||0}">Terjual ${t.product_sale||0}</p>\n\n                        <div class="product__price">\n                            <h5>${t.product_price[0].product_price_formatted}</h5><span>/</span>\n                            <select name="magnitude">`,t.product_price.forEach((t=>{n+=`<option data-product-price="${t.product_price}" value="${t.product_price_id}">\n                                        ${t.product_magnitude}</option>`})),n+='</select>\n                        </div>\n                    </div>\n                    <div class="product__action">\n                        <input type="number" class="form-input" name="product_qty" placeholder="Jumlah..." min="1">\n                        <a class="btn" href="#" id="buy-rollback" title="Tambah ke keranjang belanja">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="18" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm7 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>\n                        </a>\n                    </div>\n                </div>\x3c!-- product__item --\x3e'})),n+="</div>\x3c!-- product --\x3e",e.innerHTML=n}else{let t='<span class="text-muted me-1 d-block mb-3" id="result-status">0 Total produk hasil pencarian</span>\n                <h5 class="mb-2 main__title">Produk</h5>\n                <p>Produk tidak ada.</p>';e.innerHTML=t}const a=document.querySelector("span#limit-message");if(t.products_db.length===t.product_limit&&null===a){const e=document.createElement("span");e.classList.add("text-muted"),e.classList.add("d-block"),e.classList.add("mb-5"),e.setAttribute("id","limit-message"),e.innerHTML=`Hanya ${t.product_limit} Produk terbaru yang ditampilkan, Pakai fitur <i>Pencarian</i> untuk hasil lebih spesifik!`,document.querySelector("div.product").after(e)}else t.products_db.length!==t.product_limit&&null!==a&&a.remove()})).catch((t=>{console.error(t)}))}));let y=!0;function _(t,e,r,n,d,o,s,l,i,u,p,y){if(r<=0)return!1;document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/ubah_jumlah_produk",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`product_qty_new=${r}&transaction_detail_id=${i}&${u}=${p}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((s=>{if(void 0!==s.csrf_value&&(y.dataset.csrfValue=s.csrf_value),"success"===s.status){const s=t.parentElement.parentElement;!function(t,e,r){t.querySelector("td#qty").innerText=e,t.querySelector("td#qty").dataset.qty=e,t.querySelector("td#payment").innerText=a(r),t.querySelector("td#payment").dataset.payment=r}(s,r,d),c(e,n,o);const i=document.querySelector(`div.product__item[data-product-id="${s.dataset.productId}"] p.product__sale`);null!==i&&(i.innerText=`Terjual ${l}`,i.dataset.productSale=l);m(parseInt(document.querySelector('input[name="customer_money"]').value),o)}})).catch((t=>{console.error(t)}))}function h(t){t.querySelector("tbody").innerHTML='<tr id="empty-cart-table"><td colspan="7"></td></tr>',t.querySelector("td#qty-total").innerText=0,t.querySelector("td#qty-total").dataset.qtyTotal=0,t.querySelector("td#payment-total").innerText="Rp 0",t.querySelector("td#payment-total").dataset.paymentTotal=0,document.querySelector('input[name="customer_money"]').value="",document.querySelector('input[name="change_money"]').value="";const e=document.querySelectorAll("aside.cart small.form-message");e.length>0&&e.forEach((t=>t.remove())),delete t.dataset.typeShow}function v(t){const e=document.querySelector("aside.cart div#customer-money small.form-message");if(null!==e)e.innerText=t;else{const e=document.createElement("small");e.classList.add("form-message"),e.classList.add("form-message--danger"),e.innerText=t,document.querySelector("aside.cart div#customer-money").append(e)}}function f(t,e,a,r){const n=a.querySelectorAll("tbody tr[data-product-id]"),d=function(t){let e=[];return t.forEach(((t,a)=>{e[a]=t.dataset.transactionDetailId})),e}(n);document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/rollback_transaksi_batal",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`transaction_detail_ids=${d}&${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{if(void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),"success"===t.status){(function(t,e){let a=[],r=0;for(const n of e){let e=!1;for(const a of t)if(n.dataset.productId===a.produk_id){e=!0;break}!1===e&&(a[r]={product_id:n.dataset.productId,product_qty:parseInt(n.querySelector("td#qty").dataset.qty)},r++)}for(const n of t){let t=0;for(const a of e)if(n.produk_id===a.dataset.productId){t=a.querySelector("td#qty").dataset.qty;break}let d=0;d=0!==t?parseInt(t)-n.jumlah_produk:0-n.jumlah_produk,a[r]={product_id:n.produk_id,product_qty:d},r++}return a})(t.transaction_details,n).forEach((t=>{const e=document.querySelector(`div.product__item[data-product-id="${t.product_id}"] p.product__sale`);if(null!==e){const a=parseInt(e.dataset.productSale)-t.product_qty;e.dataset.productSale=a,e.innerText=`Terjual ${a}`}})),h(a)}})).catch((t=>{console.error(t)}))}document.querySelector('aside.cart input[name="customer_money"]').addEventListener("input",(t=>{!0===y&&(y=!1,setTimeout((()=>{m(parseInt(t.target.value),parseInt(document.querySelector("aside.cart td#payment-total").dataset.paymentTotal)),y=!0}),300))})),r.querySelector("div.container-xl").addEventListener("click",(t=>{let n=t.target;if("buy-rollback"!==n.getAttribute("id")&&(n=n.parentElement),"buy-rollback"!==n.getAttribute("id")&&(n=n.parentElement),"buy-rollback"===n.getAttribute("id")){t.preventDefault();const i=n.parentElement.previousElementSibling.querySelector('select[name="magnitude"]').value,u=n.previousElementSibling.value,p=r.dataset.csrfName,y=r.dataset.csrfValue;if(""===u.trim())return!1;document.querySelector("div#transaction-loading").classList.remove("d-none"),d.classList.add("btn--disabled"),o.classList.add("btn--disabled"),s.classList.add("btn--disabled"),fetch("/kasir/beli_produk",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`product_price_id=${i}&product_qty=${u}&${p}=${y}`}).finally((()=>{document.querySelector("div#transaction-loading").classList.add("d-none"),d.classList.remove("btn--disabled"),o.classList.remove("btn--disabled"),s.classList.remove("btn--disabled")})).then((t=>t.json())).then((t=>{if(void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),n.previousElementSibling.value="","success"===t.status){const e=n.parentElement.previousElementSibling.querySelector("p.product__sale"),r=parseInt(u)+parseInt(e.dataset.productSale);if(e.innerText=`Terjual ${r}`,e.dataset.productSale=r,void 0!==l.dataset.typeShow){null!==l.querySelector("tr#empty-cart-table")&&l.querySelector("tr#empty-cart-table").remove();const e=n.parentElement.parentElement.dataset.productId,r=n.parentElement.previousElementSibling,d=r.querySelector("p.product__name").textContent,o=r.querySelector('select[name="magnitude"]').selectedOptions[0].dataset.productPrice,s=r.querySelector('select[name="magnitude"]').selectedOptions[0].text,i=parseInt(o)*parseInt(u),p=document.createElement("tr");p.setAttribute("data-product-id",e),p.setAttribute("data-transaction-detail-id",t.transaction_detail_id),p.innerHTML=`<td width="10"><a href="#" title="Hapus produk" id="remove-product"  class="text-hover-red">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="19" fill="currentColor" viewBox="0 0 16 16"><path d="M2.037 3.225l1.684 10.104A2 2 0 0 0 5.694 15h4.612a2 2 0 0 0 1.973-1.671l1.684-10.104C13.627 4.224 11.085 5 8 5c-3.086 0-5.627-.776-5.963-1.775z"/><path fill-rule="evenodd" d="M12.9 3c-.18-.14-.497-.307-.974-.466C10.967 2.214 9.58 2 8 2s-2.968.215-3.926.534c-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466zM8 5c3.314 0 6-.895 6-2s-2.686-2-6-2-6 .895-6 2 2.686 2 6 2z"/></svg>\n                        </a></td>\n                        <td width="10"><a href="#" title="Tambah jumlah produk" id="add-product-qty">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 11.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z"/></svg>\n                        </a></td>\n                        <td width="10"><a href="#" title="Kurangi jumlah produk" id="reduce-product-qty">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="17" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z"/></svg>\n                        </a></td>\n\n                        <td>${d}</td>\n                        <td id="price" data-price="${o}">\n                            ${a(parseInt(o))} / ${s}\n                        </td>\n                        <td id="qty" data-qty="${u}">${u}</td>\n                        <td id="payment" data-payment="${i}">${a(i)}</td>`,l.querySelector("tbody").append(p);const y=l.querySelector("td#payment-total").dataset.paymentTotal,_=l.querySelector("td#qty-total").dataset.qtyTotal,h=i+parseInt(y),v=parseInt(u)+parseInt(_);c(l,v,h);m(parseInt(document.querySelector('input[name="customer_money"]').value),h)}}else if("fail"===t.status){const t=e(["alert--warning","alert--fixed-rb"],"Beli produk gagal, muat ulang halaman lalu coba kembali!");r.append(t)}})).catch((t=>{console.error(t)}))}})),document.querySelector("aside.cart table.table tbody").addEventListener("click",(t=>{const e=r.dataset.csrfName,a=r.dataset.csrfValue;let n=t.target;"add-product-qty"!==n.getAttribute("id")&&(n=n.parentElement),"add-product-qty"!==n.getAttribute("id")&&(n=n.parentElement);let d=t.target;"reduce-product-qty"!==d.getAttribute("id")&&(d=d.parentElement),"reduce-product-qty"!==d.getAttribute("id")&&(d=d.parentElement);let o=t.target;if("remove-product"!==o.getAttribute("id")&&(o=o.parentElement),"remove-product"!==o.getAttribute("id")&&(o=o.parentElement),"add-product-qty"===n.getAttribute("id")){t.preventDefault();const d=n.parentElement.parentElement.dataset.transactionDetailId,o=parseInt(n.parentElement.parentElement.querySelector("td#price").dataset.price),s=parseInt(l.querySelector("td#payment-total").dataset.paymentTotal),c=parseInt(n.parentElement.parentElement.querySelector("td#qty").dataset.qty)+1,i=parseInt(l.querySelector("td#qty-total").dataset.qtyTotal)+1,u=c*o,p=s+o,m=n.parentElement.parentElement.dataset.productId,y=document.querySelector(`div.product__item[data-product-id="${m}"] p.product__sale`);let h=0;null!==y&&(h=parseInt(y.dataset.productSale)+1),_(n,l,c,i,u,p,0,h,d,e,a,r)}else if("reduce-product-qty"===d.getAttribute("id")){t.preventDefault();const n=d.parentElement.parentElement.dataset.transactionDetailId,o=parseInt(d.parentElement.parentElement.querySelector("td#price").dataset.price),s=parseInt(l.querySelector("td#payment-total").dataset.paymentTotal),c=parseInt(d.parentElement.parentElement.querySelector("td#qty").dataset.qty)-1,i=parseInt(l.querySelector("td#qty-total").dataset.qtyTotal)-1,u=c*o,p=s-o,m=d.parentElement.parentElement.dataset.productId,y=document.querySelector(`div.product__item[data-product-id="${m}"] p.product__sale`);let h=0;null!==y&&(h=parseInt(y.dataset.productSale)-1),_(d,l,c,i,u,p,0,h,n,e,a,r)}else if("remove-product"===o.getAttribute("id")){t.preventDefault();const n=o.parentElement.parentElement.dataset.transactionDetailId,d=parseInt(o.parentElement.parentElement.querySelector("td#payment").dataset.payment),s=parseInt(l.querySelector("td#payment-total").dataset.paymentTotal),i=parseInt(o.parentElement.parentElement.querySelector("td#qty").dataset.qty),u=parseInt(l.querySelector("td#qty-total").dataset.qtyTotal)-i,p=s-d,y=o.parentElement.parentElement.dataset.productId,_=document.querySelector(`div.product__item[data-product-id="${y}"] p.product__sale`);let h=0;null!==_&&(h=parseInt(_.dataset.productSale)-i),function(t,e,a,r,n,d,o,s,l,i){document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/hapus_produk_dari_keranjang_belanja",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`transaction_detail_id=${o}&${s}=${l}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((o=>{void 0!==o.csrf_value&&(i.dataset.csrfValue=o.csrf_value),"success"===o.status&&(c(e,a,r),null!==n&&(n.innerText=`Terjual ${d}`,n.dataset.productSale=d),t.parentElement.parentElement.remove(),m(parseInt(document.querySelector('input[name="customer_money"]').value),r),null===e.querySelector("tbody tr")&&(e.querySelector("tbody").innerHTML='<tr id="empty-cart-table"><td colspan="7"></td></tr>'))})).catch((t=>{console.error(t)}))}(o,l,u,p,_,h,n,e,a,r)}})),s.addEventListener("click",(t=>{t.preventDefault();const e=r.dataset.csrfName,a=r.dataset.csrfValue,n=document.querySelector('input[name="customer_money"]').value;"transaction"===l.dataset.typeShow?function(t,e,a,r,n,d){document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/transaksi_selesai",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`customer_money=${d}&${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),"success"===t.status&&(n.click(),h(a)),"fail"===t.status&&v(t.message)})).catch((t=>{console.error(t)}))}(e,a,l,r,p,n):"rollback-transaction"===l.dataset.typeShow&&function(t,e,a,r,n,d){document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/rollback_transaksi_selesai",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`customer_money=${d}&${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),"success"===t.status&&(n.click(),h(a)),"fail"===t.status&&v(t.message)})).catch((t=>{console.error(t)}))}(e,a,l,r,p,n)})),o.addEventListener("click",(t=>{t.preventDefault();const e=r.dataset.csrfName,a=r.dataset.csrfValue;"transaction"===l.dataset.typeShow?function(t,e,a,r){document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/transaksi_batal",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`${t}=${e}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((t=>{void 0!==t.csrf_value&&(r.dataset.csrfValue=t.csrf_value),"success"===t.status&&(a.querySelectorAll("tbody tr[data-product-id]").forEach((t=>{const e=document.querySelector(`div.product__item[data-product-id="${t.dataset.productId}"] p.product__sale`);if(null!==e){const a=parseInt(e.dataset.productSale)-parseInt(t.querySelector("td#qty").dataset.qty);e.dataset.productSale=a,e.innerText=`Terjual ${a}`}})),h(a))})).catch((t=>{console.error(t)}))}(e,a,l,r):"rollback-transaction"===l.dataset.typeShow&&f(e,a,l,r)}));const q=document.querySelector(".modal"),S=q.querySelector(".modal__content");document.querySelector("a#rollback-transaction").addEventListener("click",(t=>{if(t.preventDefault(),"transaction"===l.dataset.typeShow){const a=e(["alert--warning","mb-3"],"Tidak bisa melakukan rollback transaksi, karena kamu masih melakukan transaksi. Selesaikan atau batalkan transaksi, lalu coba kembali!");return t.target.parentElement.insertBefore(a,t.target),!1}if("rollback-transaction"===l.dataset.typeShow){const a=e(["alert--warning","mb-3"],"Tidak bisa melakukan rollback transaksi lagi, karena kamu masih melakukan rollback transaksi. Selesaikan atau batalkan rollback transkasi, lalu coba kembali!");return t.target.parentElement.insertBefore(a,t.target),!1}const a=r.dataset.csrfName,n=r.dataset.csrfValue;document.querySelector("div#cart-loading").classList.remove("d-none"),fetch("/kasir/tampil_transaksi_tiga_hari_yang_lalu",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`${a}=${n}`}).finally((()=>{document.querySelector("div#cart-loading").classList.add("d-none")})).then((t=>t.json())).then((a=>{if(void 0!==a.csrf_value&&(r.dataset.csrfValue=a.csrf_value),a.transactions_three_days_ago.length>0){!function(t,e){t.classList.add("d-block"),setTimeout((()=>{t.classList.add("modal--fade-in")}),50),setTimeout((()=>{e.classList.add("modal__content--animate-show")}),200)}(q,S);let t="<option>Riwayat Transaksi</option>";a.transactions_three_days_ago.forEach((e=>{t+=`<option value="${e.transaksi_id}">${e.waktu_buat}</option>`})),S.querySelector('select[name="transactions_three_days_ago"]').innerHTML=t}else{const a=e(["alert--info","mb-3"],"Tidak ada transaksi dari 3 hari yang lalu.");t.target.parentElement.insertBefore(a,t.target)}})).catch((t=>{console.error(t)}))})),S.querySelector("a#btn-close").addEventListener("click",(e=>{e.preventDefault(),t(q,S),S.querySelector('select[name="transactions_three_days_ago"]').innerHTML=""})),document.querySelector("div.modal a#show-transaction-detail").addEventListener("click",(e=>{e.preventDefault();const a=r.dataset.csrfName,n=r.dataset.csrfValue,d=S.querySelector('select[name="transactions_three_days_ago"]').value;if("riwayat transaksi"===d.toLowerCase())return!1;e.target.nextElementSibling.classList.remove("d-none"),fetch("/kasir/tampil_transaksi_detail_tiga_hari_yang_lalu",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:`transaction_id=${d}&${a}=${n}`}).finally((()=>{e.target.nextElementSibling.classList.add("d-none")})).then((t=>t.json())).then((e=>{void 0!==e.csrf_value&&(r.dataset.csrfValue=e.csrf_value),t(q,S),S.querySelector('select[name="transactions_three_days_ago"]').innerHTML="",e.transaction_details.length>0&&i(l,e.transaction_details);const a=parseInt(e.customer_money);document.querySelector('input[name="customer_money"]').value=a;m(a,parseInt(l.querySelector("td#payment-total").dataset.paymentTotal)),l.dataset.typeShow="rollback-transaction"})).catch((t=>{console.error(t)}))}))}();
